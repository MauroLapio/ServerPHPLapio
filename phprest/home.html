<!DOCTYPE html>
<html>
    <head>
        <title>Esempio ajax</title>

        <script>
            var xhr;

            var id;
            var nome;
            var cognome;
            var sidi;
            var tax;

            function output(obj) //DA AGGIUNGERE I TASTI PER MODIFICARE GLI STUDENTI E CATCH ERRORI
            {
                document.getElementById("bodyRisposta").innerHTML = "";
                if(!Array.isArray(obj))
                {
                    obj=Array.from(obj);
                }
                //scrivo la risposta nel body della pagina
                for(var i = 0; i<obj.length;i++)
                {
                    var stud = document.createElement("tr");
                    stud.className = "studente";

                    var idth= document.createElement("th");
                    var idtext = document.createTextNode(obj[i].id);
                    idth.appendChild(idtext);
                    stud.appendChild(idth);

                    var ntd= document.createElement("td");
                    var ntext = document.createTextNode(obj[i].name);
                    ntd.appendChild(ntext);
                    stud.appendChild(ntd);

                    var ctd= document.createElement("td");
                    var ctext = document.createTextNode(obj[i].surname);
                    ctd.appendChild(ctext);
                    stud.appendChild(ctd);

                    var std= document.createElement("td");
                    var stext = document.createTextNode(obj[i].sidi_code);
                    std.appendChild(stext);
                    stud.appendChild(std);

                    var ttd= document.createElement("td");
                    var ttext = document.createTextNode(obj[i].tax_code);
                    ttd.appendChild(ttext);
                    stud.appendChild(ttd);

                    document.getElementById('bodyRisposta').appendChild(stud);
                }
            }

            function get()
            {
                document.getElementById("contentRisposta").style.display="block";
                //preparo la richiesta ajax
                xhr = new XMLHttpRequest();
                //asincrona
                xhr.open("GET", 'http://localhost:8000/api.php', true);
                //configuro la callback di risposta ok
                xhr.onload = function()
                {
                    var obj = JSON.parse(xhr.response.slice(1,-2)); //viene creato un array dal JSON ricevuto dopo aver modificato la risposta per creare l'array in modo corretto
                    output(obj);
                };
                //configuro la callback di errore
                xhr.onerror = function()
                { 
                    alert('Errore');
                };
                //invio la richiesta ajax
                xhr.send();
            }

            function getid()
            {
                document.getElementById("contentRisposta").style.display="block";

                id = document.getElementById("inputId").value;
                xhr = new XMLHttpRequest();
                xhr.open("GET", 'http://localhost:8000/api.php?id='+id, true);
                xhr.onload = function()
                {
                    var obj = JSON.parse(xhr.response); //viene creato un array dal JSON ricevuto dopo aver modificato la risposta per creare l'array in modo corretto
                    output(obj);
                }
                xhr.onerror = function()
                { 
                    alert('Errore');
                };
                xhr.send();
            }

            function deleteid()
            {
                document.getElementById("contentRisposta").style.display="block";
                
                id = document.getElementById("inputId").value;
                xhr = new XMLHttpRequest();
                xhr.open("DELETE", 'http://localhost:8000/api.php?id='+id, true);
                xhr.onload = function()
                {
                    var obj = JSON.parse(xhr.response.slice(1,-2)); //viene creato un array dal JSON ricevuto dopo aver modificato la risposta per creare l'array in modo corretto
                    output(obj);
                }
                xhr.onerror = function()
                { 
                    alert('Errore');
                };
                xhr.send();
            }

            function post()
            {
                document.getElementById("contentRisposta").style.display="block";

                nome = document.getElementById("inputNome").value;
                cognome = document.getElementById("inputCognome").value;
                sidi = document.getElementById("inputSidi").value;
                tax = document.getElementById("inputTax").value;
                xhr = new XMLHttpRequest();
                xhr.open("POST", 'http://localhost:8000/api.php', true);
                xhr.onload = function()
                {
                    var obj = JSON.parse(xhr.response.slice(1,-2)); //viene creato un array dal JSON ricevuto dopo aver modificato la risposta per creare l'array in modo corretto
                    output(obj);
                }
                xhr.onerror = function()
                { 
                    alert('Errore');
                };
                xhr.send(
                    JSON.stringify({
                        "name":nome,
                        "surname":cognome,
                        "sidi_code":sidi,
                        "tax_code":tax
                    })
                );
            }

            function patch()
            {
                document.getElementById("contentRisposta").style.display="block";

                id = document.getElementById("inputId2").value;
                nome = document.getElementById("inputNome2").value;
                cognome = document.getElementById("inputCognome2").value;
                sidi = document.getElementById("inputSidi2").value;
                tax = document.getElementById("inputTax2").value;
                xhr = new XMLHttpRequest();
                xhr.open("PATCH", 'http://localhost:8000/api.php', true);
                xhr.onload = function()
                {
                    var obj = JSON.parse(xhr.response.slice(1,-2)); //viene creato un array dal JSON ricevuto dopo aver modificato la risposta per creare l'array in modo corretto
                    output(obj);
                }
                xhr.onerror = function()
                { 
                    alert('Errore');
                };
                xhr.send(
                    JSON.stringify({
                        "id":id,
                        "name":nome,
                        "surname":cognome,
                        "sidi_code":sidi,
                        "tax_code":tax
                    })
                );
            }

            function put()
            {
                document.getElementById("contentRisposta").style.display="block";

                id = document.getElementById("inputId2").value;
                nome = document.getElementById("inputNome2").value;
                cognome = document.getElementById("inputCognome2").value;
                sidi = document.getElementById("inputSidi2").value;
                tax = document.getElementById("inputTax2").value;
                xhr = new XMLHttpRequest();
                xhr.open("PUT", 'http://localhost:8000/api.php', true);
                xhr.onload = function()
                {
                    var obj = JSON.parse(xhr.response.slice(1,-2)); //viene creato un array dal JSON ricevuto dopo aver modificato la risposta per creare l'array in modo corretto
                    output(obj);
                }
                xhr.onerror = function()
                { 
                    alert('Errore');
                };
                xhr.send(
                    JSON.stringify({
                        "id":id,
                        "name":nome,
                        "surname":cognome,
                        "sidi_code":sidi,
                        "tax_code":tax
                    })
                );
            }
        </script>

        <!--<script>
            //preparo la richiesta ajax
            var xhr = new XMLHttpRequest();
            //sincrona
            xhr.open("GET", 'http://localhost:8000/query.php?id=64', false);
            //invio la richiesta ajax
            xhr.send();
            document.getElementById('risposta').innerHTML = xhr.response;
        </script>-->

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    </head>

    <body>
        <h2>Richiesta</h2>
        <button class="btn btn-secondary" id="get" onclick="get()">GET</button>
        <br>
        <div class="content rounded">
            <input id="inputId" placeholder="ID studente"/>
            <button class="btn btn-primary" id="getid" onclick="getid()">GET ID</button>
            <button class="btn btn-warning"id="deleteid" onclick="deleteid()">DELETE</button>
        </div>
        <div class="content row rounded">
            <div class="col-6">
                <input id="inputNome" placeholder="Nome"/><br>
                <input id="inputCognome" placeholder="Cognome"/><br>
                <input id="inputSidi" placeholder="Codice SIDI"/><br>
                <input id="inputTax" placeholder="Codice fiscale"/><br>
            </div>
            <div class="col-6">
                <button class="btn btn-info" id="post" onclick="post()">POST</button>
            </div>
        </div>
        <div class="content row rounded">
            <div class="col-6">
                <input id="inputId2" placeholder="ID Studente"/><br>
                <input id="inputNome2" placeholder="Nome"/><br>
                <input id="inputCognome2" placeholder="Cognome"/><br>
                <input id="inputSidi2" placeholder="Codice SIDI"/><br>
                <input id="inputTax2" placeholder="Codice fiscale"/><br>
            </div>
            <div class="col-6">
                <button class="btn btn-success" id="patch" onclick="patch()">PATCH</button>
                <br>
                <button class="btn btn-success" id="put" onclick="put()">PUT</button>
            </div>
        </div>
        <div id="contentRisposta">
            <h2>Risposta</h2>
            <table class="table table-hover content rounded" id="risposta">
                <thead style="border:solid #2a6ba0 3px">
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Nome</th>
                        <th scope="col">Cognome</th>
                        <th scope="col">SIDI</th>
                        <th scope="col">Codice fiscale</th>
                    </tr>
                </thead>
                <tbody id="bodyRisposta"></tbody>
            </table>
        </div>
    </body>
</html>

<style>
    body
    {
        margin-left:300px;
        margin-top:50px;
    }

    .content, .btn
    {
        margin: auto;
        margin-top:25px;
        margin-bottom:25px;
    }

    .content
    {
        text-align:center;
        margin-right:60%;
        padding:10px;
        background-color: #b4ddff;
    }

    #post
    {
        margin:0;
        margin-top:50px;
    }

    #risposta
    {
        width:60%;
        text-align:left;
    }

    #contentRisposta
    {
        display:none;
    }

    .studente
    {
        border:solid #2a6ba0 3px;
    }

    th
    {
        color:#2a6ba0;
    }

    #getid
    {
        margin-left:25%;
    }

    input
    {
        margin-top:5px;
        margin-bottom:5px;
    }
</style>